# gulp-check-unused-css

[![Build Status](http://img.shields.io/travis/zalando/gulp-check-unused-css.svg)](https://travis-ci.org/zalando/gulp-check-unused-css)

Check if all your defined CSS classes are used in your HTML files.

## Installation

    npm install --save-dev gulp-check-unused-css

## Usage
    
    var checkCSS = require( 'gulp-check-unused-css' );
    gulp
        .src( 'allmy.css' )
        .pipe( checkCSS({
            files: 'templates/*.html'
        }))
        .on( 'error', function( err ) {
            // unnecessary since gulp-check-unused-css logs by default
            console.log( 'Unused classes:', err.unused );
        });

If there are no unused classes it will just output your CSS file for later usage, e.g. minifying.

In case you don't want an error event, but instead the stream to end, use the ``end`` flag. This is especially useful when used together with ``gulp-watch`` since an error will trip it up. It will not fail, but also stop working correctly.

    watch({ glob: 'allmy.css' })
        .pipe( checkCSS({
            end: true,
            files: 'templates/*.html'
        }))
        .pipe( whatever )
        .pipe( gulp.dest(... ) );

## Options

* ``files``: Glob that matches your HTML templates.
* ``ignore``: Array containing strings and regexes, if an unused class matches one of it, it is ignored.
* ``globals``: Predefined sets of ignored classes.
* ``angular``: Boolean, passing ``false`` will turn off the support for ``ng-class``
* ``end``: Boolean, passing ``true`` will cause the plugin to end the stream instead of emitting error events.

## AngularJS

In AngularJS it is possible to dynamically add classes via ``ng-class``. This syntax is supported by default, but you can turn it off by adding ``angular: false`` to your options.

## Ignoring classes

Sometimes you style classes in your CSS that are not explicitly used in your templates. Either you inlined the HTML in your code (*ewww*) or maybe they are generated by a framework you use, e.g. AngularJS. That's where you want to exclude classes from being checked.

You can provide a list of class names or regular expressions that should be ignored.

    gulp
        .src( 'my.css' )
        .pipe( checkCSS({
            files: 'templates/*.html',
            ignore: [ 'ignore-me', 'me-too', /ignore*/gi, /me-?too/ ]
        }))
        .pipe( gulp.dest( ... ) );

### Globals

This plugin is inspired by the workflow at Github, where a build fails if the classes used in the CSS and the templates do not match exactly. However, most of us do not write 100 % of the CSS ourselves but rely on frameworks such as Bootstrap. So how to ignore all of Bootstrap in our CSS?

Since 1.1.0 the answer is to add ``globals: [Â 'bootstrap@{version}' ]`` to your options. Currently only ``3.2.0`` is supported.

## Development

    git clone gulp-check-unused-css
    cd gulp-check-unused-css
    npm install
    # hack hack hack
    npm test

### Add a global

0. Fork the project
1. Acquire CSS file
2. ``cd gulp-check-unused-css``
3. ``node util/extract.js --file { path to CSS file }``
4. Now there is a ``.ignore`` file which is actually a CommonJS module exporting all CSS classes in the file
5. Rename it appropriately to ``{framework}@{version}.js``
6. Save it to ``src/global``
7. Commit and submit a Pull Request